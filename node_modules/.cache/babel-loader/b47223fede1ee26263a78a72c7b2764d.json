{"ast":null,"code":"import _asyncToGenerator from \"C:/react-pc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _regeneratorRuntime from \"C:/react-pc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(loadContacts),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(loadConversations),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(addMessageToConversation),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(createNewConversation),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(watchGetContact),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(watchGetConversation),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(watchAddMessageToConversation),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(watchCreateConversation),\n    _marked9 = /*#__PURE__*/_regeneratorRuntime.mark(rootSaga);\n\nimport { all, call, fork, put, takeEvery } from 'redux-saga/effects';\nimport { getCurrentTime } from '../../helpers/Utils';\nimport { CHAT_GET_CONTACTS, CHAT_GET_CONVERSATIONS, CHAT_ADD_MESSAGE_TO_CONVERSATION, CHAT_CREATE_CONVERSATION } from '../actions';\nimport { getContactsSuccess, getContactsError, getConversationsSuccess, getConversationsError } from './actions';\nimport contactsData from '../../data/chat.contacts.json';\nimport conversationsData from '../../data/chat.conversations.json';\n\nfunction loadContacts() {\n  var response, contacts, currentUser;\n  return _regeneratorRuntime.wrap(function loadContacts$(_context) {\n    while (1) switch (_context.prev = _context.next) {\n      case 0:\n        _context.prev = 0;\n        _context.next = 3;\n        return call(loadContactsAsync);\n\n      case 3:\n        response = _context.sent;\n        contacts = response.contacts, currentUser = response.currentUser;\n        _context.next = 7;\n        return put(getContactsSuccess(contacts, currentUser));\n\n      case 7:\n        _context.next = 13;\n        break;\n\n      case 9:\n        _context.prev = 9;\n        _context.t0 = _context[\"catch\"](0);\n        _context.next = 13;\n        return put(getContactsError(_context.t0));\n\n      case 13:\n      case \"end\":\n        return _context.stop();\n    }\n  }, _marked, null, [[0, 9]]);\n}\n\nconst loadContactsAsync = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var contacts, currentUser;\n    return _regeneratorRuntime.wrap(function _callee$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          contacts = contactsData.data;\n          currentUser = contacts[0]; // eslint-disable-next-line no-return-await\n\n          _context2.next = 4;\n          return new Promise(success => {\n            setTimeout(() => {\n              success({\n                contacts,\n                currentUser\n              });\n            }, 2000);\n          }).then(response => response).catch(error => error);\n\n        case 4:\n          return _context2.abrupt(\"return\", _context2.sent);\n\n        case 5:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee);\n  }));\n\n  return function loadContactsAsync() {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nfunction loadConversations(userId) {\n  var response, conversations, selectedUser;\n  return _regeneratorRuntime.wrap(function loadConversations$(_context3) {\n    while (1) switch (_context3.prev = _context3.next) {\n      case 0:\n        _context3.prev = 0;\n        _context3.next = 3;\n        return call(loadConversationsAsync, userId);\n\n      case 3:\n        response = _context3.sent;\n        conversations = response.conversations, selectedUser = response.selectedUser;\n        _context3.next = 7;\n        return put(getConversationsSuccess(conversations, selectedUser));\n\n      case 7:\n        _context3.next = 13;\n        break;\n\n      case 9:\n        _context3.prev = 9;\n        _context3.t0 = _context3[\"catch\"](0);\n        _context3.next = 13;\n        return put(getConversationsError(_context3.t0));\n\n      case 13:\n      case \"end\":\n        return _context3.stop();\n    }\n  }, _marked2, null, [[0, 9]]);\n}\n\nconst loadConversationsAsync = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2({\n    payload\n  }) {\n    var conversations, selectedUser;\n    return _regeneratorRuntime.wrap(function _callee2$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          conversations = conversationsData.data;\n          conversations = conversations.filter(x => x.users.includes(payload));\n          selectedUser = conversations[0].users.find(x => x !== payload); // eslint-disable-next-line no-return-await\n\n          _context4.next = 5;\n          return new Promise(success => {\n            setTimeout(() => {\n              success({\n                conversations,\n                selectedUser\n              });\n            }, 1000);\n          }).then(response => response).catch(error => error);\n\n        case 5:\n          return _context4.abrupt(\"return\", _context4.sent);\n\n        case 6:\n        case \"end\":\n          return _context4.stop();\n      }\n    }, _callee2);\n  }));\n\n  return function loadConversationsAsync(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nfunction addMessageToConversation({\n  payload\n}) {\n  var currentUserId, selectedUserId, message, allConversations, response, conversations, selectedUser;\n  return _regeneratorRuntime.wrap(function addMessageToConversation$(_context5) {\n    while (1) switch (_context5.prev = _context5.next) {\n      case 0:\n        _context5.prev = 0;\n        currentUserId = payload.currentUserId, selectedUserId = payload.selectedUserId, message = payload.message, allConversations = payload.allConversations;\n        _context5.next = 4;\n        return call( // eslint-disable-next-line no-use-before-define\n        addMessageToConversationAsync, currentUserId, selectedUserId, message, allConversations);\n\n      case 4:\n        response = _context5.sent;\n        conversations = response.conversations, selectedUser = response.selectedUser;\n        _context5.next = 8;\n        return put(getConversationsSuccess(conversations, selectedUser));\n\n      case 8:\n        _context5.next = 14;\n        break;\n\n      case 10:\n        _context5.prev = 10;\n        _context5.t0 = _context5[\"catch\"](0);\n        _context5.next = 14;\n        return put(getConversationsError(_context5.t0));\n\n      case 14:\n      case \"end\":\n        return _context5.stop();\n    }\n  }, _marked3, null, [[0, 10]]);\n}\n\nconst addMessageToConversationAsync = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(currentUserId, selectedUserId, message, allConversations // eslint-disable-next-line consistent-return\n  ) {\n    var conversation, time, conversations;\n    return _regeneratorRuntime.wrap(function _callee3$(_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          conversation = allConversations.find(x => x.users.includes(currentUserId) && x.users.includes(selectedUserId));\n          time = getCurrentTime();\n\n          if (!conversation) {\n            _context6.next = 10;\n            break;\n          }\n\n          conversation.messages.push({\n            sender: currentUserId,\n            time,\n            text: message\n          });\n          conversation.lastMessageTime = time;\n          conversations = allConversations.filter(x => x.id !== conversation.id);\n          conversations.splice(0, 0, conversation); // eslint-disable-next-line no-return-await\n\n          _context6.next = 9;\n          return new Promise(success => {\n            setTimeout(() => {\n              success({\n                conversations,\n                selectedUser: selectedUserId\n              });\n            }, 500);\n          }).then(response => response).catch(error => error);\n\n        case 9:\n          return _context6.abrupt(\"return\", _context6.sent);\n\n        case 10:\n        case \"end\":\n          return _context6.stop();\n      }\n    }, _callee3);\n  }));\n\n  return function addMessageToConversationAsync(_x2, _x3, _x4, _x5) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nfunction createNewConversation({\n  payload\n}) {\n  var currentUserId, selectedUserId, allConversations, response, conversations, selectedUser;\n  return _regeneratorRuntime.wrap(function createNewConversation$(_context7) {\n    while (1) switch (_context7.prev = _context7.next) {\n      case 0:\n        _context7.prev = 0;\n        currentUserId = payload.currentUserId, selectedUserId = payload.selectedUserId, allConversations = payload.allConversations;\n        _context7.next = 4;\n        return call( // eslint-disable-next-line no-use-before-define\n        createNewConversationAsync, currentUserId, selectedUserId, allConversations);\n\n      case 4:\n        response = _context7.sent;\n        conversations = response.conversations, selectedUser = response.selectedUser;\n        _context7.next = 8;\n        return put(getConversationsSuccess(conversations, selectedUser));\n\n      case 8:\n        _context7.next = 14;\n        break;\n\n      case 10:\n        _context7.prev = 10;\n        _context7.t0 = _context7[\"catch\"](0);\n        _context7.next = 14;\n        return put(getConversationsError(_context7.t0));\n\n      case 14:\n      case \"end\":\n        return _context7.stop();\n    }\n  }, _marked4, null, [[0, 10]]);\n}\n\nconst createNewConversationAsync = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(currentUserId, selectedUserId, allConversations) {\n    var conversation;\n    return _regeneratorRuntime.wrap(function _callee4$(_context8) {\n      while (1) switch (_context8.prev = _context8.next) {\n        case 0:\n          conversation = {\n            id: allConversations.length + 1,\n            users: [currentUserId, selectedUserId],\n            lastMessageTime: '-',\n            messages: []\n          };\n          allConversations.splice(0, 0, conversation); // eslint-disable-next-line no-return-await\n\n          _context8.next = 4;\n          return new Promise(success => {\n            setTimeout(() => {\n              success({\n                conversations: allConversations,\n                selectedUser: selectedUserId\n              });\n            }, 500);\n          }).then(response => response).catch(error => error);\n\n        case 4:\n          return _context8.abrupt(\"return\", _context8.sent);\n\n        case 5:\n        case \"end\":\n          return _context8.stop();\n      }\n    }, _callee4);\n  }));\n\n  return function createNewConversationAsync(_x6, _x7, _x8) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexport function watchGetContact() {\n  return _regeneratorRuntime.wrap(function watchGetContact$(_context9) {\n    while (1) switch (_context9.prev = _context9.next) {\n      case 0:\n        _context9.next = 2;\n        return takeEvery(CHAT_GET_CONTACTS, loadContacts);\n\n      case 2:\n      case \"end\":\n        return _context9.stop();\n    }\n  }, _marked5);\n}\nexport function watchGetConversation() {\n  return _regeneratorRuntime.wrap(function watchGetConversation$(_context10) {\n    while (1) switch (_context10.prev = _context10.next) {\n      case 0:\n        _context10.next = 2;\n        return takeEvery(CHAT_GET_CONVERSATIONS, loadConversations);\n\n      case 2:\n      case \"end\":\n        return _context10.stop();\n    }\n  }, _marked6);\n}\nexport function watchAddMessageToConversation() {\n  return _regeneratorRuntime.wrap(function watchAddMessageToConversation$(_context11) {\n    while (1) switch (_context11.prev = _context11.next) {\n      case 0:\n        _context11.next = 2;\n        return takeEvery(CHAT_ADD_MESSAGE_TO_CONVERSATION, addMessageToConversation);\n\n      case 2:\n      case \"end\":\n        return _context11.stop();\n    }\n  }, _marked7);\n}\nexport function watchCreateConversation() {\n  return _regeneratorRuntime.wrap(function watchCreateConversation$(_context12) {\n    while (1) switch (_context12.prev = _context12.next) {\n      case 0:\n        _context12.next = 2;\n        return takeEvery(CHAT_CREATE_CONVERSATION, createNewConversation);\n\n      case 2:\n      case \"end\":\n        return _context12.stop();\n    }\n  }, _marked8);\n}\nexport default function rootSaga() {\n  return _regeneratorRuntime.wrap(function rootSaga$(_context13) {\n    while (1) switch (_context13.prev = _context13.next) {\n      case 0:\n        _context13.next = 2;\n        return all([fork(watchGetContact), fork(watchGetConversation), fork(watchAddMessageToConversation), fork(watchCreateConversation)]);\n\n      case 2:\n      case \"end\":\n        return _context13.stop();\n    }\n  }, _marked9);\n}","map":{"version":3,"sources":["C:/react-pc/src/redux/chat/saga.js"],"names":["loadContacts","loadConversations","addMessageToConversation","createNewConversation","watchGetContact","watchGetConversation","watchAddMessageToConversation","watchCreateConversation","rootSaga","all","call","fork","put","takeEvery","getCurrentTime","CHAT_GET_CONTACTS","CHAT_GET_CONVERSATIONS","CHAT_ADD_MESSAGE_TO_CONVERSATION","CHAT_CREATE_CONVERSATION","getContactsSuccess","getContactsError","getConversationsSuccess","getConversationsError","contactsData","conversationsData","loadContactsAsync","response","contacts","currentUser","data","Promise","success","setTimeout","then","catch","error","userId","loadConversationsAsync","conversations","selectedUser","payload","filter","x","users","includes","find","currentUserId","selectedUserId","message","allConversations","addMessageToConversationAsync","conversation","time","messages","push","sender","text","lastMessageTime","id","splice","createNewConversationAsync","length"],"mappings":"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","sourcesContent":["import { all, call, fork, put, takeEvery } from 'redux-saga/effects';\r\nimport { getCurrentTime } from '../../helpers/Utils';\r\n\r\nimport {\r\n  CHAT_GET_CONTACTS,\r\n  CHAT_GET_CONVERSATIONS,\r\n  CHAT_ADD_MESSAGE_TO_CONVERSATION,\r\n  CHAT_CREATE_CONVERSATION,\r\n} from '../actions';\r\n\r\nimport {\r\n  getContactsSuccess,\r\n  getContactsError,\r\n  getConversationsSuccess,\r\n  getConversationsError,\r\n} from './actions';\r\n\r\nimport contactsData from '../../data/chat.contacts.json';\r\nimport conversationsData from '../../data/chat.conversations.json';\r\n\r\nfunction* loadContacts() {\r\n  try {\r\n    // eslint-disable-next-line no-use-before-define\r\n    const response = yield call(loadContactsAsync);\r\n    const { contacts, currentUser } = response;\r\n    yield put(getContactsSuccess(contacts, currentUser));\r\n  } catch (error) {\r\n    yield put(getContactsError(error));\r\n  }\r\n}\r\n\r\nconst loadContactsAsync = async () => {\r\n  const contacts = contactsData.data;\r\n  const currentUser = contacts[0];\r\n  // eslint-disable-next-line no-return-await\r\n  return await new Promise((success) => {\r\n    setTimeout(() => {\r\n      success({ contacts, currentUser });\r\n    }, 2000);\r\n  })\r\n    .then((response) => response)\r\n    .catch((error) => error);\r\n};\r\n\r\nfunction* loadConversations(userId) {\r\n  try {\r\n    // eslint-disable-next-line no-use-before-define\r\n    const response = yield call(loadConversationsAsync, userId);\r\n    const { conversations, selectedUser } = response;\r\n    yield put(getConversationsSuccess(conversations, selectedUser));\r\n  } catch (error) {\r\n    yield put(getConversationsError(error));\r\n  }\r\n}\r\n\r\nconst loadConversationsAsync = async ({ payload }) => {\r\n  let conversations = conversationsData.data;\r\n  conversations = conversations.filter((x) => x.users.includes(payload));\r\n  const selectedUser = conversations[0].users.find((x) => x !== payload);\r\n  // eslint-disable-next-line no-return-await\r\n  return await new Promise((success) => {\r\n    setTimeout(() => {\r\n      success({ conversations, selectedUser });\r\n    }, 1000);\r\n  })\r\n    .then((response) => response)\r\n    .catch((error) => error);\r\n};\r\n\r\nfunction* addMessageToConversation({ payload }) {\r\n  try {\r\n    const {\r\n      currentUserId,\r\n      selectedUserId,\r\n      message,\r\n      allConversations,\r\n    } = payload;\r\n\r\n    const response = yield call(\r\n      // eslint-disable-next-line no-use-before-define\r\n      addMessageToConversationAsync,\r\n      currentUserId,\r\n      selectedUserId,\r\n      message,\r\n      allConversations\r\n    );\r\n    const { conversations, selectedUser } = response;\r\n    yield put(getConversationsSuccess(conversations, selectedUser));\r\n  } catch (error) {\r\n    yield put(getConversationsError(error));\r\n  }\r\n}\r\nconst addMessageToConversationAsync = async (\r\n  currentUserId,\r\n  selectedUserId,\r\n  message,\r\n  allConversations\r\n  // eslint-disable-next-line consistent-return\r\n) => {\r\n  const conversation = allConversations.find(\r\n    (x) => x.users.includes(currentUserId) && x.users.includes(selectedUserId)\r\n  );\r\n  const time = getCurrentTime();\r\n  if (conversation) {\r\n    conversation.messages.push({\r\n      sender: currentUserId,\r\n      time,\r\n      text: message,\r\n    });\r\n    conversation.lastMessageTime = time;\r\n    const conversations = allConversations.filter(\r\n      (x) => x.id !== conversation.id\r\n    );\r\n    conversations.splice(0, 0, conversation);\r\n\r\n    // eslint-disable-next-line no-return-await\r\n    return await new Promise((success) => {\r\n      setTimeout(() => {\r\n        success({ conversations, selectedUser: selectedUserId });\r\n      }, 500);\r\n    })\r\n      .then((response) => response)\r\n      .catch((error) => error);\r\n  }\r\n};\r\n\r\nfunction* createNewConversation({ payload }) {\r\n  try {\r\n    const { currentUserId, selectedUserId, allConversations } = payload;\r\n    const response = yield call(\r\n      // eslint-disable-next-line no-use-before-define\r\n      createNewConversationAsync,\r\n      currentUserId,\r\n      selectedUserId,\r\n      allConversations\r\n    );\r\n    const { conversations, selectedUser } = response;\r\n    yield put(getConversationsSuccess(conversations, selectedUser));\r\n  } catch (error) {\r\n    yield put(getConversationsError(error));\r\n  }\r\n}\r\n\r\nconst createNewConversationAsync = async (\r\n  currentUserId,\r\n  selectedUserId,\r\n  allConversations\r\n) => {\r\n  const conversation = {\r\n    id: allConversations.length + 1,\r\n    users: [currentUserId, selectedUserId],\r\n    lastMessageTime: '-',\r\n    messages: [],\r\n  };\r\n\r\n  allConversations.splice(0, 0, conversation);\r\n  // eslint-disable-next-line no-return-await\r\n  return await new Promise((success) => {\r\n    setTimeout(() => {\r\n      success({\r\n        conversations: allConversations,\r\n        selectedUser: selectedUserId,\r\n      });\r\n    }, 500);\r\n  })\r\n    .then((response) => response)\r\n    .catch((error) => error);\r\n};\r\n\r\nexport function* watchGetContact() {\r\n  yield takeEvery(CHAT_GET_CONTACTS, loadContacts);\r\n}\r\nexport function* watchGetConversation() {\r\n  yield takeEvery(CHAT_GET_CONVERSATIONS, loadConversations);\r\n}\r\nexport function* watchAddMessageToConversation() {\r\n  yield takeEvery(CHAT_ADD_MESSAGE_TO_CONVERSATION, addMessageToConversation);\r\n}\r\nexport function* watchCreateConversation() {\r\n  yield takeEvery(CHAT_CREATE_CONVERSATION, createNewConversation);\r\n}\r\n\r\nexport default function* rootSaga() {\r\n  yield all([\r\n    fork(watchGetContact),\r\n    fork(watchGetConversation),\r\n    fork(watchAddMessageToConversation),\r\n    fork(watchCreateConversation),\r\n  ]);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}